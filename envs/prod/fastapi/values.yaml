image:
  tag: sha-619a130

service:
  name: fastapi-prod-service
  port: 80
  type: ClusterIP

ingresses:
  - name: fastapi-prod
    host: fastapi.prod
    className: nginx
    whitelist: 0.0.0.0/0
    paths:
      - path: /
        pathType: Prefix
    tls:
      enabled: true
      secretName: fastapi-prod-tls
      issuerName: selfsigned-issuer
      createCertificate: true
    excludeMetrics: true

env:
  MLFLOW_TRACKING_URI: "http://mlflow-prod-service.mlflow-prod.svc.cluster.local:5000"
  MODEL_NAME: "best_model"
  DEFAULT_ALIAS: "B"
  ALIAS_SELECTION_MODE: "ab_test"
  CANARY_PERCENT: "10"
  LOG_TO_STDOUT: "true"
  LOG_LEVEL: "info"
  TRITON_HTTP_URL: "http://triton.triton-prod.svc.cluster.local:8000"
  TRITON_MODEL_NAME: "best_model"

  # -----------------------------
  # Traffic Control (prod vs shadow)
  # -----------------------------
  TRAFFIC_MODE: "mirror"              # off | mirror
  TRAFFIC_SHADOW_PERCENT: "10"        # 0~100
  TRAFFIC_STICKY_MODE: "user_hash"    # off | user_hash
  TRAFFIC_STICKY_SALT: "prod-v1"      # (선택) sticky 재현성

  # prod/shadow Triton endpoints (명시)
  TRITON_HTTP_URL_PROD: "http://triton.triton-prod.svc.cluster.local:8000"
  TRITON_HTTP_URL_SHADOW: "http://triton.triton-dev.svc.cluster.local:8000"

envFrom:
  - secretRef:
      name: aws-credentials-secret
  - secretRef:
      name: fastapi-token-prod-secret
  - secretRef:
      name: slack-webhook-prod-secret

monitoring:
  releaseLabel: monitoring-prod
