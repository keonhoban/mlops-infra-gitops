deploymentMode: SingleBinary

loki:
  auth_enabled: false

  # Chart validate 통과용 (필수)
  schemaConfig:
    configs:
      - from: "2026-01-01"
        store: tsdb
        object_store: s3
        schema: v13
        index:
          prefix: loki_index_
          period: 24h

  storage:
    type: s3
    bucketNames:
      chunks: loki-chunks
      ruler: loki-ruler
      admin: loki-admin

  structuredConfig:
    auth_enabled: false

    server:
      http_listen_port: 3100
      grpc_listen_port: 9095
      http_server_read_timeout: 600s
      http_server_write_timeout: 600s

    common:
      path_prefix: /var/loki
      replication_factor: 1
      compactor_grpc_address: loki-dev.baseline-dev.svc.cluster.local:9095

      storage:
        s3:
          endpoint: http://minio-dev.baseline-dev.svc.cluster.local:9000
          access_key_id: minioadmin
          secret_access_key: minioadmin
          insecure: true
          s3forcepathstyle: true

      # ✅ 핵심: consul 기본값 차단 (localhost:8500 방지)
      ring:
        kvstore:
          store: memberlist

    schema_config:
      configs:
        - from: "2026-01-01"
          store: tsdb
          object_store: s3
          schema: v13
          index:
            prefix: loki_index_
            period: 24h

    compactor:
      retention_enabled: true
      delete_request_store: s3
      retention_delete_delay: 2h
      retention_delete_worker_count: 150
      working_directory: /var/loki/compactor

    limits_config:
      reject_old_samples: true
      reject_old_samples_max_age: 168h
      retention_period: 168h
      query_timeout: 300s
      split_queries_by_interval: 15m
      max_cache_freshness_per_query: 10m
      volume_enabled: true

    # ✅ 핵심: memberlist 조인 주소 명시 (서비스 DNS)
    memberlist:
      join_members:
        - loki-dev-memberlist.baseline-dev.svc.cluster.local

    query_range:
      cache_results: false

    storage_config:
      tsdb_shipper:
        index_gateway_client:
          server_address: ""

    ruler:
      storage:
        type: s3
        s3:
          endpoint: http://minio-dev.baseline-dev.svc.cluster.local:9000
          bucketnames: loki-ruler
          access_key_id: minioadmin
          secret_access_key: minioadmin
          insecure: true
          s3forcepathstyle: true
      wal:
        dir: /var/loki/ruler-wal

singleBinary:
  replicas: 1

  # (선택) 느슨하게 유지. 지금처럼 넉넉하게 주는 게 안정적입니다.
  readinessProbe:
    initialDelaySeconds: 60
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 12
    successThreshold: 1

  persistence:
    enabled: true
    size: 20Gi
    storageClass: local-path
  resources: {}

backend:
  replicas: 0
read:
  replicas: 0
write:
  replicas: 0

memcached:
  enabled: false
memcachedChunks:
  enabled: false
memcachedFrontend:
  enabled: false
memcachedIndexQueries:
  enabled: false
memcachedIndexWrites:
  enabled: false
memcachedResults:
  enabled: false

chunksCache:
  enabled: false
resultsCache:
  enabled: false

lokiCanary:
  enabled: true

gateway:
  enabled: false

